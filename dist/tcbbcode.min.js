"use strict";class BBCode{constructor(){this.output="",this.openTags=[],this.captureUrl=!1,this.url="",this.params=[],this.allowedColors=["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","purple","red","silver","teal","white","yellow"],this.inlineTags=["b","i","u","s","del","ins","em","url","color","style","size","img","spoiler","sub","sup"],this.blockTags=["center","right","left","quote","pre","code","h1","h2","h3","h4","h5","h6","table","tr","th","td","list","ol","ul","li","youtube"]}tagAllowedInContext(t){var e=t=>0<this.openTags.length&&this.openTags[this.openTags.length-1]===t;if(this.blockTags.includes(t)&&0<this.openTags.length&&this.inlineTags.includes(this.openTags[this.openTags.length-1]))return!1;switch(t){case"tr":return e("table");case"td":case"th":return e("tr");case"li":return e("ul")||e("ol")||e("list");default:return!0}}startTag(t){if("string"!=typeof t)throw new Error("BBCode.startTag(tag): tag must be a string.");let e;var s;switch(!0){case/^\[b\]$/i.test(t):this.output+="<b>";break;case/^\[i\]$/i.test(t):this.output+="<i>";break;case/^\[u\]$/i.test(t):this.output+="<u>";break;case/^\[s\]$/i.test(t):this.output+="<s>";break;case/^\[del\]$/i.test(t):this.output+="<del>";break;case/^\[ins\]$/i.test(t):this.output+="<ins>";break;case/^\[em\]$/i.test(t):this.output+="<em>";break;case/^\[sub\]$/i.test(t):this.output+="<sub>";break;case/^\[sup\]$/i.test(t):this.output+="<sup>";break;case/^\[size=[0-9]+\]$/i.test(t):this.output+=`<span style="font-size: ${t.slice(6,-1)}pt;">`;break;case/^\[style size=[0-9]+\]$/i.test(t):this.output+=`<span style="font-size: ${t.slice(12,-1)}pt;">`;break;case/^\[color=([A-Za-z]+|#[0-9a-f]{6})\]$/i.test(t):if(e=t.slice(7,-1).toLowerCase(),!e.startsWith("#")&&!this.allowedColors.includes(e))throw new Error("BBCode.startTag(tag): invalid color or hex code");this.output+=`<span style="color: ${e};">`;break;case/^\[style color=([A-Za-z]+|#[0-9a-f]{6})\]$/i.test(t):if(e=t.slice(13,-1).toLowerCase(),!e.startsWith("#")&&!this.allowedColors.includes(e))throw new Error("BBCode.startTag(tag): invalid color or hex code");this.output+=`<span style="color: ${e};">`;break;case/^\[center\]$/i.test(t):this.output+='<div style="text-align: center;">';break;case/^\[left\]$/i.test(t):this.output+='<div style="text-align: left;">';break;case/^\[right\]$/i.test(t):this.output+='<div style="text-align: right;">';break;case/^\[quote\]$/i.test(t):this.output+="<blockquote>";break;case/^\[pre\]$/i.test(t):this.output+="<pre>";break;case/^\[code\]$/i.test(t):this.output+="<div><pre><code>";break;case/^\[code=[A-Za-z]+\]$/i.test(t):this.output+=`<div class="bbcode-code-lang-${t.slice(6,-1).toLowerCase()}"><pre><code>`;break;case/^\[h1\]$/i.test(t):this.output+="<h1>";break;case/^\[h2\]$/i.test(t):this.output+="<h2>";break;case/^\[h3\]$/i.test(t):this.output+="<h3>";break;case/^\[h4\]$/i.test(t):this.output+="<h4>";break;case/^\[h5\]$/i.test(t):this.output+="<h5>";break;case/^\[h6\]$/i.test(t):this.output+="<h6>";break;case/^\[table\]$/i.test(t):this.output+="<table>";break;case/^\[tr\]$/i.test(t):this.output+="<tr>";break;case/^\[td\]$/i.test(t):this.output+="<td>";break;case/^\[th\]$/i.test(t):this.output+="<th>";break;case/^\[list\]$/i.test(t):case/^\[ul\]$/i.test(t):this.output+="<ul>";break;case/^\[ol\]$/i.test(t):this.output+="<ol>";break;case/^\[li\]$/i.test(t):this.output+="<li>";break;case/^\[img\]$/i.test(t):this.url="",this.captureUrl=!0,this.params=[];break;case/^\[img=[1-9][0-9]*x[1-9][0-9]*\]$/i.test(t):this.url="",this.captureUrl=!0,this.params=t.slice(5,-1).toLowerCase().split("x");break;case/^\[img width=[1-9][0-9]* height=[1-9][0-9]*\]$/i.test(t):this.url="",this.captureUrl=!0,this.params=t.slice(5,-1).split(" ").map(t=>t.split("=")[1]);break;case/^\[youtube\]$/i.test(t):case/^\[url\]$/i.test(t):this.url="",this.captureUrl=!0;break;case/^\[url=[^\]]+\]$/i.test(t):try{if(s=new URL(t.slice(5,-1)).toString(),/^javascript/i.test(s))throw new Error("BBCode.startTag(tag): javascript scheme not allowed");this.output+=`<a href="${s}">`}catch(t){throw new Error("BBCode.startTag(tag): Invalid URL")}break;default:throw new Error("BBCode.startTag(tag): unrecognized BBCode")}var i=t.slice(1).split(/[ =\]]/)[0];if(!this.tagAllowedInContext(i))throw new Error("BBCode.startTag(tag): tag not allowed in this context");this.openTags.push(i)}text(t){if("string"!=typeof t)throw new Error("BBCode.text(txt): txt must be a string.");this.captureUrl?this.url=t:this.output+=t}endTag(t){if("string"!=typeof t)throw new Error("BBCode.endTag(tag): tag must be a string.");switch(!0){case/^\[\/b\]$/i.test(t):this.output+="</b>";break;case/^\[\/i\]$/i.test(t):this.output+="</i>";break;case/^\[\/u\]$/i.test(t):this.output+="</u>";break;case/^\[\/s\]$/i.test(t):this.output+="</s>";break;case/^\[\/del\]$/i.test(t):this.output+="</del>";break;case/^\[\/ins\]$/i.test(t):this.output+="</ins>";break;case/^\[\/em\]$/i.test(t):this.output+="</em>";break;case/^\[\/sub\]$/i.test(t):this.output+="</sub>";break;case/^\[\/sup\]$/i.test(t):this.output+="</sup>";break;case/^\[\/size\]$/i.test(t):case/^\[\/style\]$/i.test(t):case/^\[\/color\]$/i.test(t):this.output+="</span>";break;case/^\[\/center\]$/i.test(t):case/^\[\/left\]$/i.test(t):case/^\[\/right\]$/i.test(t):this.output+="</div>";break;case/^\[\/quote\]$/i.test(t):this.output+="</blockquote>";break;case/^\[\/pre\]$/i.test(t):this.output+="</pre>";break;case/^\[\/code\]$/i.test(t):this.output+="</code></pre></div>";break;case/^\[\/h1\]$/i.test(t):this.output+="</h1>";break;case/^\[\/h2\]$/i.test(t):this.output+="</h2>";break;case/^\[\/h3\]$/i.test(t):this.output+="</h3>";break;case/^\[\/h4\]$/i.test(t):this.output+="</h4>";break;case/^\[\/h5\]$/i.test(t):this.output+="</h5>";break;case/^\[\/h6\]$/i.test(t):this.output+="</h6>";break;case/^\[\/table\]$/i.test(t):this.output+="</table>";break;case/^\[\/tr\]$/i.test(t):this.output+="</tr>";break;case/^\[\/td\]$/i.test(t):this.output+="</td>";break;case/^\[\/th\]$/i.test(t):this.output+="</th>";break;case/^\[\/list\]$/i.test(t):case/^\[\/ul\]$/i.test(t):this.output+="</ul>";break;case/^\[\/ol\]$/i.test(t):this.output+="</ol>";break;case/^\[\/li\]$/i.test(t):this.output+="</li>";break;case/^\[\/img\]$/i.test(t):var e=2===this.params.length?`width="${this.params[0]}" height="${this.params[1]}" `:"";if(this.params=[],!this.captureUrl)throw new Error("BBCode.endTag(tag): internal error");this.captureUrl=!1;try{this.output+=`<img src="${new URL(this.url).toString()}" alt="${BBCode.basename(new URL(this.url).pathname)}" ${e}/>`}catch(t){throw new Error("Invalid URL")}break;case/^\[\/youtube\]$/i.test(t):if(!this.captureUrl)throw new Error("BBCode.endTag(tag): internal error");if(this.captureUrl=!1,!/^[A-Za-z0-9_\-]{11}$/.test(this.url))throw new Error("BBCode.endTag(tag): bad youtube_id");this.output+=`<div><iframe width="560" height="315" src="https://www.youtube.com/embed/${this.url}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;break;case/^\[\/url\]$/i.test(t):if(this.captureUrl){this.captureUrl=!1;try{this.output+=`<a href="${new URL(this.url).toString()}">`,this.output+=this.url}catch(t){throw new Error("Invalid URL")}}this.output+="</a>";break;default:throw new Error("BBCode.endTag(tag): unrecognized BBCode")}if(this.openTags.pop()!==t.slice(2).split(/[ =\]]/)[0])throw new Error("BBCode.endTag(tag): unbalanced tags")}done(){if(0!==this.openTags.length)throw new Error("BBCode.done(): missing closing tag(s)");var t=this.output;return this.output="",t}parse(t){if("string"!=typeof t)throw new Error("BBCode.parse(input): input must be a string.");this.output="",this.openTags=[],t=BBCode.encodeHtmlEntities(t).split("");let e="",s=!1;for(;0<t.length;){var i=t.shift();s&&"]"===i?(e+=i,s=!1,"/"===e[1]?this.endTag(e):this.startTag(e),e=""):s||"["!==i?e+=i:(t.unshift(i),s=!0,0<e.length&&this.text(e),e="")}return this.output+=e,this.done()}static encodeHtmlEntities(t){if("string"!=typeof t)throw new Error("BBCode.encodeEntities(input): input must be a string.");return t.replace(/[\u00A0-\u9999<>\&"']/gim,t=>`&#${t.charCodeAt(0)};`)}static basename(t){return`${t}`.split("/").pop()}}function tcbbcode(t){return(new BBCode).parse(t)}"object"==typeof module&&null!==module&&(module.exports=tcbbcode);